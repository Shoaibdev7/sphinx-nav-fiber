import{r as g,b as Bt,g as Ft,s as Te,_ as Z,u as Wt,ac as uo,a as Yt,j as o,c as Gt,bo as Ye,bp as ct,d as Ht,e as fe,f as yt,ad as po,ae as fo,b9 as lt,o as L,T as se,F as w,aW as De,q as V,bq as ho,br as et,bs as mo,b8 as Ut,O as Zt,a9 as Be,aV as pe,a0 as bt,Z as wt,Y as jt,X as vt,V as go,M as xo,ao as Ct}from"./index-1a3014d2.js";import{B as yo}from"./index-a6236c2f.js";import{i as dt,B as Oe,F as Xt,k as ut,p as bo,h as wo,I as jo,q as vo,b as Kt}from"./index-945bc2fb.js";import{A as Fe,O as Co,a as Et,N as qt}from"./index-3e17d28a.js";import{T as We}from"./index-d0ca765c.js";import{C as le}from"./ClipLoader-536b1b65.js";import{D as Qt}from"./DeleteIcon-5cdd5447.js";import{P as Jt}from"./PlusIcon-f8618cec.js";import{p as it,c as Eo,g as Po}from"./index-44e303ef.js";import{e as To}from"./Stack-d065c421.js";import{S as Oo}from"./SwitchBase-3cfedea4.js";import{g as Mo,m as Ao,u as J,b as Ge,t as at,T as eo,i as to,H as _o,j as Pt,C as So,P as $o,k as No}from"./index-d89dbb75.js";import{Z as Io,_ as ko,E as zo,V as I,$ as de,a0 as ue,a1 as Tt,P as Re,a2 as Ve,a3 as Ot,a as K,a4 as Ro,G as Vo,C as Lo}from"./three.module-2ce81f73.js";import"./Popover-51fb4e8a.js";import"./useSlotProps-84737601.js";import"./createSvgIcon-f7803a9c.js";import"./TextareaAutosize-5071ca59.js";import"./index.esm-084fbb7c.js";import"./InfoIcon-a9d0c663.js";const Do=g.createContext(),Mt=Do;function Bo(t){return Bt("MuiGrid",t)}const Fo=[0,1,2,3,4,5,6,7,8,9,10],Wo=["column-reverse","column","row-reverse","row"],Yo=["nowrap","wrap-reverse","wrap"],Ee=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Go=Ft("MuiGrid",["root","container","item","zeroMinWidth",...Fo.map(t=>`spacing-xs-${t}`),...Wo.map(t=>`direction-xs-${t}`),...Yo.map(t=>`wrap-xs-${t}`),...Ee.map(t=>`grid-xs-${t}`),...Ee.map(t=>`grid-sm-${t}`),...Ee.map(t=>`grid-md-${t}`),...Ee.map(t=>`grid-lg-${t}`),...Ee.map(t=>`grid-xl-${t}`)]),Pe=Go,Ho=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function he(t){const n=parseFloat(t);return`${n}${String(t).replace(String(n),"")||"px"}`}function Uo({theme:t,ownerState:n}){let s;return t.breakpoints.keys.reduce((e,a)=>{let l={};if(n[a]&&(s=n[a]),!s)return e;if(s===!0)l={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(s==="auto")l={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const u=Ye({values:n.columns,breakpoints:t.breakpoints.values}),i=typeof u=="object"?u[a]:u;if(i==null)return e;const c=`${Math.round(s/i*1e8)/1e6}%`;let E={};if(n.container&&n.item&&n.columnSpacing!==0){const d=t.spacing(n.columnSpacing);if(d!=="0px"){const h=`calc(${c} + ${he(d)})`;E={flexBasis:h,maxWidth:h}}}l=Z({flexBasis:c,flexGrow:0,maxWidth:c},E)}return t.breakpoints.values[a]===0?Object.assign(e,l):e[t.breakpoints.up(a)]=l,e},{})}function Zo({theme:t,ownerState:n}){const s=Ye({values:n.direction,breakpoints:t.breakpoints.values});return ct({theme:t},s,e=>{const a={flexDirection:e};return e.indexOf("column")===0&&(a[`& > .${Pe.item}`]={maxWidth:"none"}),a})}function oo({breakpoints:t,values:n}){let s="";Object.keys(n).forEach(a=>{s===""&&n[a]!==0&&(s=a)});const e=Object.keys(t).sort((a,l)=>t[a]-t[l]);return e.slice(0,e.indexOf(s))}function Xo({theme:t,ownerState:n}){const{container:s,rowSpacing:e}=n;let a={};if(s&&e!==0){const l=Ye({values:e,breakpoints:t.breakpoints.values});let u;typeof l=="object"&&(u=oo({breakpoints:t.breakpoints.values,values:l})),a=ct({theme:t},l,(i,c)=>{var E;const d=t.spacing(i);return d!=="0px"?{marginTop:`-${he(d)}`,[`& > .${Pe.item}`]:{paddingTop:he(d)}}:(E=u)!=null&&E.includes(c)?{}:{marginTop:0,[`& > .${Pe.item}`]:{paddingTop:0}}})}return a}function Ko({theme:t,ownerState:n}){const{container:s,columnSpacing:e}=n;let a={};if(s&&e!==0){const l=Ye({values:e,breakpoints:t.breakpoints.values});let u;typeof l=="object"&&(u=oo({breakpoints:t.breakpoints.values,values:l})),a=ct({theme:t},l,(i,c)=>{var E;const d=t.spacing(i);return d!=="0px"?{width:`calc(100% + ${he(d)})`,marginLeft:`-${he(d)}`,[`& > .${Pe.item}`]:{paddingLeft:he(d)}}:(E=u)!=null&&E.includes(c)?{}:{width:"100%",marginLeft:0,[`& > .${Pe.item}`]:{paddingLeft:0}}})}return a}function qo(t,n,s={}){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[s[`spacing-xs-${String(t)}`]];const e=[];return n.forEach(a=>{const l=t[a];Number(l)>0&&e.push(s[`spacing-${a}-${String(l)}`])}),e}const Qo=Te("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t,{container:e,direction:a,item:l,spacing:u,wrap:i,zeroMinWidth:c,breakpoints:E}=s;let d=[];e&&(d=qo(u,E,n));const h=[];return E.forEach(m=>{const x=s[m];x&&h.push(n[`grid-${m}-${String(x)}`])}),[n.root,e&&n.container,l&&n.item,c&&n.zeroMinWidth,...d,a!=="row"&&n[`direction-xs-${String(a)}`],i!=="wrap"&&n[`wrap-xs-${String(i)}`],...h]}})(({ownerState:t})=>Z({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},t.wrap!=="wrap"&&{flexWrap:t.wrap}),Zo,Xo,Ko,Uo);function Jo(t,n){if(!t||t<=0)return[];if(typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number")return[`spacing-xs-${String(t)}`];const s=[];return n.forEach(e=>{const a=t[e];if(Number(a)>0){const l=`spacing-${e}-${String(a)}`;s.push(l)}}),s}const en=t=>{const{classes:n,container:s,direction:e,item:a,spacing:l,wrap:u,zeroMinWidth:i,breakpoints:c}=t;let E=[];s&&(E=Jo(l,c));const d=[];c.forEach(m=>{const x=t[m];x&&d.push(`grid-${m}-${String(x)}`)});const h={root:["root",s&&"container",a&&"item",i&&"zeroMinWidth",...E,e!=="row"&&`direction-xs-${String(e)}`,u!=="wrap"&&`wrap-xs-${String(u)}`,...d]};return Ht(h,Bo,n)},tn=g.forwardRef(function(n,s){const e=Wt({props:n,name:"MuiGrid"}),{breakpoints:a}=uo(),l=To(e),{className:u,columns:i,columnSpacing:c,component:E="div",container:d=!1,direction:h="row",item:m=!1,rowSpacing:x,spacing:y=0,wrap:b="wrap",zeroMinWidth:P=!1}=l,v=Yt(l,Ho),j=x||y,A=c||y,M=g.useContext(Mt),C=d?i||12:M,$={},D=Z({},v);a.keys.forEach(f=>{v[f]!=null&&($[f]=v[f],delete D[f])});const z=Z({},l,{columns:C,container:d,direction:h,item:m,rowSpacing:j,columnSpacing:A,wrap:b,zeroMinWidth:P,spacing:y},$,{breakpoints:a.keys}),F=en(z);return o.jsx(Mt.Provider,{value:C,children:o.jsx(Qo,Z({ownerState:z,className:Gt(F.root,u),as:E,ref:s},D))})}),ce=tn;function on(t){return Bt("MuiSwitch",t)}const nn=Ft("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),H=nn,sn=["className","color","edge","size","sx"],rn=t=>{const{classes:n,edge:s,size:e,color:a,checked:l,disabled:u}=t,i={root:["root",s&&`edge${fe(s)}`,`size${fe(e)}`],switchBase:["switchBase",`color${fe(a)}`,l&&"checked",u&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},c=Ht(i,on,n);return Z({},n,c)},an=Te("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.root,s.edge&&n[`edge${fe(s.edge)}`],n[`size${fe(s.size)}`]]}})(({ownerState:t})=>Z({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},t.edge==="start"&&{marginLeft:-8},t.edge==="end"&&{marginRight:-8},t.size==="small"&&{width:40,height:24,padding:7,[`& .${H.thumb}`]:{width:16,height:16},[`& .${H.switchBase}`]:{padding:4,[`&.${H.checked}`]:{transform:"translateX(16px)"}}})),cn=Te(Oo,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,n)=>{const{ownerState:s}=t;return[n.switchBase,{[`& .${H.input}`]:n.input},s.color!=="default"&&n[`color${fe(s.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${H.checked}`]:{transform:"translateX(20px)"},[`&.${H.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${H.checked} + .${H.track}`]:{opacity:.5},[`&.${H.disabled} + .${H.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${H.input}`]:{left:"-100%",width:"300%"}}),({theme:t,ownerState:n})=>Z({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:yt(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},n.color!=="default"&&{[`&.${H.checked}`]:{color:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:yt(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${H.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${n.color}DisabledColor`]:`${t.palette.mode==="light"?po(t.palette[n.color].main,.62):fo(t.palette[n.color].main,.55)}`}},[`&.${H.checked} + .${H.track}`]:{backgroundColor:(t.vars||t).palette[n.color].main}})),ln=Te("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,n)=>n.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),dn=Te("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,n)=>n.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),un=g.forwardRef(function(n,s){const e=Wt({props:n,name:"MuiSwitch"}),{className:a,color:l="primary",edge:u=!1,size:i="medium",sx:c}=e,E=Yt(e,sn),d=Z({},e,{color:l,edge:u,size:i}),h=rn(d),m=o.jsx(dn,{className:h.thumb,ownerState:d});return o.jsxs(an,{className:Gt(h.root,a),sx:c,ownerState:d,children:[o.jsx(cn,Z({type:"checkbox",icon:m,checkedIcon:m,ref:s,ownerState:d},E,{classes:Z({},h,{root:h.switchBase})})),o.jsx(ln,{className:h.track,ownerState:d})]})}),pn=un,fn={type:"",parent:""},At=({onSelect:t,dataTestId:n,edgeLink:s,hideSelectAll:e})=>{const a=dt({mode:"onChange",defaultValues:fn}),{watch:l,setValue:u}=a,[i,c]=g.useState([]),[E,d]=g.useState(!1),h=b=>{u("parent",(b==null?void 0:b.value)||""),t(b==null?void 0:b.value)},m=b=>b.charAt(0).toUpperCase()+b.slice(1);g.useEffect(()=>{(async()=>{d(!0);try{const v=(await lt()).schemas.filter(A=>!A.is_deleted&&A.type).map(A=>(A==null?void 0:A.type)==="thing"?{label:"No Parent",value:A.type}:{label:m(A.type),value:A.type});c(e?v:[{label:"Select all",value:"all"},...v]),s&&u("parent",s)}catch(P){console.warn(P)}finally{d(!1)}})()},[s,u,e]);const x=l("parent"),y=()=>{const b=i==null?void 0:i.find(P=>P.value===x);if(b)return b;if(s)return{label:s,value:s}};return o.jsx(Fe,{dataTestId:n,disabled:!!s,isLoading:E,onSelect:h,options:i||Co,selectedValue:y()})},hn=({selectedType:t,setSelectedFromNode:n,setSelectedToNode:s,edgeLinkData:e,selectedFromNode:a,selectedToNode:l})=>{const u=l==="all",i=a==="all";return o.jsxs(w,{children:[o.jsx(w,{align:"center",direction:"row",justify:"space-between",mb:35,children:o.jsx(w,{align:"center",direction:"row",children:o.jsx(mn,{children:e!=null&&e.refId?"Edit Edge":"Add Edge"})})}),o.jsxs(w,{mb:25,children:[o.jsx(w,{mb:12,children:o.jsx(se,{children:"Source"})}),o.jsx(At,{dataTestId:"from_node",edgeLink:e==null?void 0:e.source,hideSelectAll:u,onSelect:n})]}),o.jsxs(w,{mb:10,children:[o.jsx(w,{mb:12,children:o.jsx(se,{children:"Edge Name"})}),o.jsx(w,{mb:12,children:o.jsx(We,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...De},value:t})})]}),o.jsxs(w,{mb:25,children:[o.jsx(w,{mb:12,children:o.jsx(se,{children:"Destination"})}),o.jsx(At,{dataTestId:"to_node",edgeLink:e==null?void 0:e.target,hideSelectAll:i,onSelect:s})]})]})},mn=L(se)`
  font-size: 22px;
  font-weight: 600;
`,gn=({onCancel:t,edgeLinkData:n,setGraphLoading:s})=>{var $,D,z;const e=dt({mode:"onChange"}),{setValue:a,getValues:l}=e,[u,i]=g.useState(!1),[c,E]=g.useState(!1),[d,h]=g.useState(""),[m,x]=g.useState(""),[y,b]=g.useState(""),P=e.watch("type");g.useEffect(()=>{a("type",n==null?void 0:n.edgeType)},[n==null?void 0:n.edgeType,a]),g.useEffect(()=>{h(P)},[P]);const v=e.handleSubmit(async F=>{i(!0),s(!0);const f={source:m,target:y,edge_type:F.type},_={ref_id:n==null?void 0:n.refId,edge_type:F.type};try{if(n!=null&&n.refId)await ho(_);else if(y&&m)if(m==="all"||y==="all"){const S=(await lt()).schemas.filter(W=>!W.is_deleted&&W.type).map(W=>W.type);m==="all"?await Promise.all(S.map(W=>et({...f,source:W}))):y==="all"&&await Promise.all(S.map(W=>et({...f,target:W})))}else await et(f)}catch(B){console.warn("API Error:",B)}finally{i(!1),s(!1),x(""),b(""),t()}}),j=(D=($=l())==null?void 0:$.type)==null?void 0:D.trim(),A=j&&((z=n==null?void 0:n.edgeType)==null?void 0:z.trim())!==j,M=n!=null&&n.refId?u||!A:u||!y||!m||!d,C=async()=>{E(!0),s(!0);try{n!=null&&n.refId&&await mo(n==null?void 0:n.refId)}catch(F){console.warn("API Error:",F)}finally{E(!1),s(!1),x(""),b(""),t()}};return o.jsx(Xt,{...e,children:o.jsxs("form",{id:"add-type-form",onSubmit:v,children:[o.jsx(hn,{edgeLinkData:n,selectedFromNode:m,selectedToNode:y,selectedType:d,setSelectedFromNode:x,setSelectedToNode:b}),o.jsxs(w,{direction:"row",justify:"space-between",mt:20,children:[(n==null?void 0:n.refId)&&o.jsx(w,{direction:"column",children:o.jsxs(yn,{color:"secondary",disabled:c,onClick:C,size:"large",style:{marginRight:20},variant:"contained",children:["Delete",c&&o.jsxs(_t,{children:[o.jsx(le,{color:V.lightGray,size:12})," "]})]})}),o.jsxs(xn,{color:"secondary",disabled:M,onClick:v,size:"large",variant:"contained",children:["Confirm",u&&o.jsxs(_t,{children:[o.jsx(le,{color:V.lightGray,size:12})," "]})]})]})]})})},xn=L(Oe)`
  width: 293px !important;
  margin: 0 0 10px auto !important;
`,_t=L.span`
  margin-top: 2px;
`,yn=L(Oe)`
  && {
    color: ${V.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${V.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,bn=({setIsAddEdgeNode:t,edgeData:n,setGraphLoading:s})=>{const e=()=>{t(!1)};return o.jsxs(w,{children:[o.jsx(w,{direction:"row",justify:"flex-end",children:o.jsx(wn,{"data-testid":"close-sidebar-sub-view",onClick:e,children:o.jsx(ut,{})})}),o.jsx(gn,{edgeLinkData:n,onCancel:e,setGraphLoading:s})]})},wn=L(w)`
  font-size: 32px;
  color: ${V.white};
  cursor: pointer;
`,jn=/^[a-z0-9_]+$/,vn=({parentParam:t,onDelete:n})=>{const[s,e]=g.useState(!1),[a,l]=g.useState([]),{fields:u,append:i,replace:c,remove:E}=bo({name:"attributes"}),{setValue:d,watch:h}=wo();return g.useEffect(()=>{const m=async()=>{try{let x=[{required:!1,type:"string",key:""}];if(t!==qt.value.toLowerCase()){e(!0);const y=await Ut(t);y.attributes&&typeof y.attributes=="object"?x=it(y.attributes):x=it(y)}x=x.filter(y=>y.key!=="node_key"),c(x),l(x)}catch(x){console.warn(x)}finally{e(!1)}};a.length===0&&m()},[t,d,c,a.length]),o.jsxs(o.Fragment,{children:[s?o.jsx(w,{align:"center",children:o.jsx(le,{color:V.SECONDARY_BLUE,size:"30"})}):o.jsx(Cn,{py:8,children:o.jsx(ce,{container:!0,spacing:2,children:u.map((m,x)=>{const y=h(`attributes[${x}].type`),b=h(`attributes[${x}].required`),P=m.isNew||!1,v=["name"].includes(h(`attributes[${x}].key`));return o.jsxs(g.Fragment,{children:[o.jsx(ce,{item:!0,xs:5,children:o.jsx(We,{autoComplete:"off",className:"text-input",dataTestId:`cy-item-name-${x}`,disabled:!P,id:`cy-item-name-${x}`,maxLength:50,name:`attributes.${x}.key`,placeholder:"Enter value",rules:{...De,pattern:{message:"Please avoid special characters, spaces and uppercase",value:jn}}})}),o.jsx(ce,{item:!0,xs:4,children:o.jsx(Fe,{dataTestId:`cy-item-select-${x}`,disabled:v,onSelect:j=>d(`attributes[${x}].type`,j==null?void 0:j.value),options:Et,selectedValue:Et.find(j=>j.value===y)})}),o.jsxs(ce,{item:!0,xs:3,children:[o.jsx(pn,{checked:b,"data-testid":`cy-item-${x}`,disabled:v,name:`attributes.${x}.required`,onChange:j=>d(`attributes[${x}].required`,j.target.checked),size:"small"}),!v&&o.jsx(jo,{onClick:()=>{E(x),m.key!==void 0&&n&&n(m.key)},children:o.jsx(Qt,{})})]})]},m.id)})})}),o.jsx(w,{align:"flex-start",py:12,children:o.jsx(Oe,{"data-testid":"add-attribute-btn",onClick:()=>i({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:o.jsx(Jt,{}),variant:"contained",children:"Add Attribute"})})]})},Cn=L(w)`
  overflow-y: auto;
  width: calc(100% + 20px);
  max-height: calc(80vh - 300px);
`,En=({parent:t,onDelete:n})=>{const s=t;return o.jsxs(w,{children:[o.jsx(w,{direction:"row",mb:10,children:o.jsxs(ce,{container:!0,spacing:2,children:[o.jsx(ce,{item:!0,xs:5,children:o.jsx(tt,{style:{marginRight:180},children:"Attributes"})}),o.jsx(ce,{item:!0,xs:4,children:o.jsx(tt,{style:{marginRight:130},children:"Type"})}),o.jsx(ce,{item:!0,xs:3,children:o.jsx(tt,{children:"Required"})})]})}),s&&o.jsx(vn,{onDelete:n,parentParam:s},s)]})},tt=L(se)`
  font-size: 15px;
  color: gray;
`,Pn={type:"",parent:""},Tn=(t,n)=>t.length!==n.length?!0:t.some((s,e)=>{const a=n[e];return s.required!==a.required||s.type!==a.type||s.key!==a.key}),On=async(t,n=!1,s)=>{try{const{attributes:e,...a}=t,l={...Eo(e),...s.reduce((c,E)=>({...c,[E]:"delete"}),{})},u={...a,attributes:l};let i;if(n?i=await Be.put(`/schema/${t.ref_id}`,JSON.stringify(u),{}):i=await Be.post("/schema",JSON.stringify({...u,node_key:"name"}),{}),i.status!=="success")throw new Error("error");return i==null?void 0:i.ref_id}catch(e){let a=pe;if(e.status===400){const l=await e.json();a=l.errorCode||(l==null?void 0:l.status)||pe}else e instanceof Error&&(a=e.message);throw new Error(a)}},Mn=t=>t.charAt(0).toUpperCase()+t.slice(1),St=async(t,n)=>{try{const l=((await lt()).schemas||[]).filter(u=>!u.is_deleted&&u.type&&(!n||n(u))).map(u=>u.type==="thing"?{label:"No Parent",value:u.type}:{label:Mn(u.type),value:u.type});t(l)}catch(s){console.warn(s)}},An=({graphLoading:t,onSchemaCreate:n,selectedSchema:s,onDelete:e,setSelectedSchemaId:a,setGraphLoading:l,setIsCreateNew:u,onSchemaUpdate:i})=>{const{close:c,visible:E}=Zt("addType"),d=dt({mode:"onChange",defaultValues:s?{type:s.type,parent:s.parent}:Pn}),{watch:h,setValue:m,reset:x,getValues:y}=d,[b,P]=g.useState(!1),[v,j]=g.useState(!1),[A,M]=g.useState(!1),[C,$]=g.useState(null),[D,z]=g.useState(!1),[F,f]=g.useState(null),[_,B]=g.useState(""),[S,W]=g.useState(null),[X,ee]=g.useState([]),[re,Q]=g.useState([]),[me,Me]=g.useState(!0);g.useEffect(()=>()=>{x()},[E,x]);const Ae=()=>{u(!1),a("")};g.useEffect(()=>{s||(M(!0),St($).finally(()=>M(!1)))},[s]),g.useEffect(()=>{(async()=>{if(s){m("type",s==null?void 0:s.type),m("parent",s.parent);let k=[{required:!1,type:"string",key:""}];if(s.type!==qt.value.toLowerCase()){const Y=await Ut(s.type);k=Y?it(Y):k}k=k.filter(Y=>Y.key!=="node_key"),Q(k),await St(f,Y=>Y.type!==s.type)}})()},[s,m]);const U=h("parent");h("type");const _e=N=>Array.isArray(N)&&N.every(k=>typeof k=="object"&&"key"in k),ge=h("attributes"),xe=g.useMemo(()=>_e(ge)?ge:[],[ge]),He=()=>{c()},Ue=N=>{ee(k=>[...k,N])},Ze=async()=>{if(s!=null&&s.type){j(!0),l(!0);try{await Be.delete(`/schema/${s.ref_id}`),e(s.type),c()}catch(N){let k=pe;if((N==null?void 0:N.status)===400){const Y=await N.json();k=Y.errorCode||(Y==null?void 0:Y.status)||pe}else N instanceof Error&&(k=N.message);W(k)}finally{j(!1),l(!1),u(!1)}}},Se=d.handleSubmit(async N=>{if(!U){z(!0);return}P(!0);try{if(s&&N.type!==(s==null?void 0:s.type)||s&&y().parent!==(s==null?void 0:s.parent)){const Y=y().parent??(s==null?void 0:s.parent);l(!0),await Be.put(`/schema/${s==null?void 0:s.ref_id}`,JSON.stringify({type:N.type,parent:Y})),await i()}const k=await On({...N,...s?{ref_id:s==null?void 0:s.ref_id}:{}},!!s,X);n({type:N.type,parent:U||"",ref_id:(s==null?void 0:s.ref_id)||k||"new"}),He()}catch(k){let Y=pe;if((k==null?void 0:k.status)===400){const ie=await k.json();Y=ie.errorCode||(ie==null?void 0:ie.status)||pe}else k instanceof Error&&(Y=k.message);B(Y)}finally{P(!1),l(!1),u(!1)}});g.useEffect(()=>{const N=d.watch(k=>{var be,we,Ne,Ie,je;const Y=Tn(xe,re),ie=((be=k.type)==null?void 0:be.trim())!==((we=s==null?void 0:s.type)==null?void 0:we.trim())||((Ne=k.parent)==null?void 0:Ne.trim())!==((Ie=s==null?void 0:s.parent)==null?void 0:Ie.trim())||Y,ye=!!((je=k.type)!=null&&je.trim());Me(s?b||!ie||!ye||D:b||D||!ye)});return()=>N.unsubscribe()},[d,xe,re,s,b,D]);const Xe=()=>C==null?void 0:C.find(N=>N.value===U),$e=()=>{const N=F==null?void 0:F.find(k=>k.value===U);if(N)return N;if(U)return{label:U,value:U}};return o.jsxs(w,{children:[o.jsx(w,{direction:"row",justify:"flex-end",children:o.jsx($n,{"data-testid":"close-sidebar-sub-view",onClick:Ae,children:o.jsx(ut,{})})}),o.jsx(w,{children:o.jsx(Xt,{...d,children:o.jsxs("form",{id:"add-type-form",onSubmit:Se,children:[o.jsx(w,{children:s?o.jsxs(o.Fragment,{children:[o.jsxs(w,{mb:12,children:[o.jsx(w,{mb:12,children:o.jsx(se,{children:"Name"})}),o.jsx(w,{mb:12,children:o.jsx(We,{dataTestId:"cy-item-name",defaultValue:s==null?void 0:s.type,id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...De},value:U})})]}),o.jsxs(w,{mb:12,children:[o.jsx(w,{mb:12,children:o.jsx(se,{children:"Parent"})}),o.jsx(Fe,{isLoading:A||t,onSelect:N=>{m("parent",(N==null?void 0:N.value)||""),z(!1)},options:F||[],selectedValue:$e()}),_&&o.jsx(ot,{children:_})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs(w,{mb:12,children:[o.jsx(w,{mb:12,children:o.jsx(se,{children:"Select Parent"})}),o.jsx(Fe,{isLoading:A,onSelect:N=>{m("parent",(N==null?void 0:N.value)||""),z(!1)},options:C,selectedValue:Xe()}),D&&o.jsx(ot,{children:"A parent type must be selected"})]}),o.jsxs(w,{children:[o.jsx(w,{mb:12,children:o.jsx(se,{children:"Type name"})}),o.jsx(w,{mb:12,children:o.jsx(We,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...De},value:U})})]})]})}),o.jsx(En,{onDelete:Ue,parent:s?s.type:U}),o.jsxs(w,{direction:"row",justify:"space-between",mt:20,children:[s&&o.jsxs(w,{direction:"column",children:[o.jsxs(Sn,{color:"secondary",disabled:v,onClick:Ze,size:"large",style:{marginRight:20},variant:"contained",children:["Delete",v&&o.jsxs($t,{children:[o.jsx(le,{color:V.lightGray,size:12})," "]})]}),S&&o.jsx(ot,{children:S})]}),o.jsxs(_n,{color:"secondary",disabled:me,onClick:Se,size:"large",variant:"contained",children:["Confirm",b&&o.jsxs($t,{children:[o.jsx(le,{color:V.lightGray,size:12})," "]})]})]})]})})})]})},_n=L(Oe)`
  width: 100% !important;
  margin: 0 auto !important;
`,$t=L.span`
  margin-top: 2px;
`,Sn=L(Oe)`
  && {
    color: ${V.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${V.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,$n=L(w)`
  font-size: 32px;
  color: ${V.white};
  cursor: pointer;
`,ot=L(w)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`;var Nn=Object.defineProperty,In=(t,n,s)=>n in t?Nn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,T=(t,n,s)=>(In(t,typeof n!="symbol"?n+"":n,s),s);const Le=new Io,Nt=new ko,kn=Math.cos(70*(Math.PI/180)),It=(t,n)=>(t%n+n)%n;let zn=class extends zo{constructor(n,s){super(),T(this,"object"),T(this,"domElement"),T(this,"enabled",!0),T(this,"target",new I),T(this,"minDistance",0),T(this,"maxDistance",1/0),T(this,"minZoom",0),T(this,"maxZoom",1/0),T(this,"minPolarAngle",0),T(this,"maxPolarAngle",Math.PI),T(this,"minAzimuthAngle",-1/0),T(this,"maxAzimuthAngle",1/0),T(this,"enableDamping",!1),T(this,"dampingFactor",.05),T(this,"enableZoom",!0),T(this,"zoomSpeed",1),T(this,"enableRotate",!0),T(this,"rotateSpeed",1),T(this,"enablePan",!0),T(this,"panSpeed",1),T(this,"screenSpacePanning",!0),T(this,"keyPanSpeed",7),T(this,"zoomToCursor",!1),T(this,"autoRotate",!1),T(this,"autoRotateSpeed",2),T(this,"reverseOrbit",!1),T(this,"reverseHorizontalOrbit",!1),T(this,"reverseVerticalOrbit",!1),T(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),T(this,"mouseButtons",{LEFT:de.ROTATE,MIDDLE:de.DOLLY,RIGHT:de.PAN}),T(this,"touches",{ONE:ue.ROTATE,TWO:ue.DOLLY_PAN}),T(this,"target0"),T(this,"position0"),T(this,"zoom0"),T(this,"_domElementKeyEvents",null),T(this,"getPolarAngle"),T(this,"getAzimuthalAngle"),T(this,"setPolarAngle"),T(this,"setAzimuthalAngle"),T(this,"getDistance"),T(this,"listenToKeyEvents"),T(this,"stopListenToKeyEvents"),T(this,"saveState"),T(this,"reset"),T(this,"update"),T(this,"connect"),T(this,"dispose"),this.object=n,this.domElement=s,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>d.phi,this.getAzimuthalAngle=()=>d.theta,this.setPolarAngle=r=>{let p=It(r,2*Math.PI),O=d.phi;O<0&&(O+=2*Math.PI),p<0&&(p+=2*Math.PI);let R=Math.abs(p-O);2*Math.PI-R<R&&(p<O?p+=2*Math.PI:O+=2*Math.PI),h.phi=p-O,e.update()},this.setAzimuthalAngle=r=>{let p=It(r,2*Math.PI),O=d.theta;O<0&&(O+=2*Math.PI),p<0&&(p+=2*Math.PI);let R=Math.abs(p-O);2*Math.PI-R<R&&(p<O?p+=2*Math.PI:O+=2*Math.PI),h.theta=p-O,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=r=>{r.addEventListener("keydown",Qe),this._domElementKeyEvents=r},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Qe),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(a),e.update(),c=i.NONE},this.update=(()=>{const r=new I,p=new I(0,1,0),O=new Tt().setFromUnitVectors(n.up,p),R=O.clone().invert(),G=new I,te=new Tt,ae=2*Math.PI;return function(){const xt=e.object.position;O.setFromUnitVectors(n.up,p),R.copy(O).invert(),r.copy(xt).sub(e.target),r.applyQuaternion(O),d.setFromVector3(r),e.autoRotate&&c===i.NONE&&W(B()),e.enableDamping?(d.theta+=h.theta*e.dampingFactor,d.phi+=h.phi*e.dampingFactor):(d.theta+=h.theta,d.phi+=h.phi);let oe=e.minAzimuthAngle,ne=e.maxAzimuthAngle;isFinite(oe)&&isFinite(ne)&&(oe<-Math.PI?oe+=ae:oe>Math.PI&&(oe-=ae),ne<-Math.PI?ne+=ae:ne>Math.PI&&(ne-=ae),oe<=ne?d.theta=Math.max(oe,Math.min(ne,d.theta)):d.theta=d.theta>(oe+ne)/2?Math.max(oe,d.theta):Math.min(ne,d.theta)),d.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,d.phi)),d.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(x,e.dampingFactor):e.target.add(x),e.zoomToCursor&&F||e.object.isOrthographicCamera?d.radius=U(d.radius):d.radius=U(d.radius*m),r.setFromSpherical(d),r.applyQuaternion(R),xt.copy(e.target).add(r),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(h.theta*=1-e.dampingFactor,h.phi*=1-e.dampingFactor,x.multiplyScalar(1-e.dampingFactor)):(h.set(0,0,0),x.set(0,0,0));let ke=!1;if(e.zoomToCursor&&F){let ve=null;if(e.object instanceof Re&&e.object.isPerspectiveCamera){const Ce=r.length();ve=U(Ce*m);const ze=Ce-ve;e.object.position.addScaledVector(D,ze),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const Ce=new I(z.x,z.y,0);Ce.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),e.object.updateProjectionMatrix(),ke=!0;const ze=new I(z.x,z.y,0);ze.unproject(e.object),e.object.position.sub(ze).add(Ce),e.object.updateMatrixWorld(),ve=r.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;ve!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(ve).add(e.object.position):(Le.origin.copy(e.object.position),Le.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(Le.direction))<kn?n.lookAt(e.target):(Nt.setFromNormalAndCoplanarPoint(e.object.up,e.target),Le.intersectPlane(Nt,e.target))))}else e.object instanceof Ve&&e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/m)),e.object.updateProjectionMatrix(),ke=!0);return m=1,F=!1,ke||G.distanceToSquared(e.object.position)>E||8*(1-te.dot(e.object.quaternion))>E?(e.dispatchEvent(a),G.copy(e.object.position),te.copy(e.object.quaternion),ke=!1,!0):!1}})(),this.connect=r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=r,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",ht),e.domElement.addEventListener("pointerdown",je),e.domElement.addEventListener("pointercancel",pt),e.domElement.addEventListener("wheel",ft)},this.dispose=()=>{var r,p,O,R,G,te;(r=e.domElement)==null||r.removeEventListener("contextmenu",ht),(p=e.domElement)==null||p.removeEventListener("pointerdown",je),(O=e.domElement)==null||O.removeEventListener("pointercancel",pt),(R=e.domElement)==null||R.removeEventListener("wheel",ft),(G=e.domElement)==null||G.ownerDocument.removeEventListener("pointermove",Ke),(te=e.domElement)==null||te.ownerDocument.removeEventListener("pointerup",qe),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Qe)};const e=this,a={type:"change"},l={type:"start"},u={type:"end"},i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=i.NONE;const E=1e-6,d=new Ot,h=new Ot;let m=1;const x=new I,y=new K,b=new K,P=new K,v=new K,j=new K,A=new K,M=new K,C=new K,$=new K,D=new I,z=new K;let F=!1;const f=[],_={};function B(){return 2*Math.PI/60/60*e.autoRotateSpeed}function S(){return Math.pow(.95,e.zoomSpeed)}function W(r){e.reverseOrbit||e.reverseHorizontalOrbit?h.theta+=r:h.theta-=r}function X(r){e.reverseOrbit||e.reverseVerticalOrbit?h.phi+=r:h.phi-=r}const ee=(()=>{const r=new I;return function(O,R){r.setFromMatrixColumn(R,0),r.multiplyScalar(-O),x.add(r)}})(),re=(()=>{const r=new I;return function(O,R){e.screenSpacePanning===!0?r.setFromMatrixColumn(R,1):(r.setFromMatrixColumn(R,0),r.crossVectors(e.object.up,r)),r.multiplyScalar(O),x.add(r)}})(),Q=(()=>{const r=new I;return function(O,R){const G=e.domElement;if(G&&e.object instanceof Re&&e.object.isPerspectiveCamera){const te=e.object.position;r.copy(te).sub(e.target);let ae=r.length();ae*=Math.tan(e.object.fov/2*Math.PI/180),ee(2*O*ae/G.clientHeight,e.object.matrix),re(2*R*ae/G.clientHeight,e.object.matrix)}else G&&e.object instanceof Ve&&e.object.isOrthographicCamera?(ee(O*(e.object.right-e.object.left)/e.object.zoom/G.clientWidth,e.object.matrix),re(R*(e.object.top-e.object.bottom)/e.object.zoom/G.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function me(r){e.object instanceof Re&&e.object.isPerspectiveCamera||e.object instanceof Ve&&e.object.isOrthographicCamera?m/=r:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Me(r){e.object instanceof Re&&e.object.isPerspectiveCamera||e.object instanceof Ve&&e.object.isOrthographicCamera?m*=r:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ae(r){if(!e.zoomToCursor||!e.domElement)return;F=!0;const p=e.domElement.getBoundingClientRect(),O=r.clientX-p.left,R=r.clientY-p.top,G=p.width,te=p.height;z.x=O/G*2-1,z.y=-(R/te)*2+1,D.set(z.x,z.y,1).unproject(e.object).sub(e.object.position).normalize()}function U(r){return Math.max(e.minDistance,Math.min(e.maxDistance,r))}function _e(r){y.set(r.clientX,r.clientY)}function ge(r){Ae(r),M.set(r.clientX,r.clientY)}function xe(r){v.set(r.clientX,r.clientY)}function He(r){b.set(r.clientX,r.clientY),P.subVectors(b,y).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(W(2*Math.PI*P.x/p.clientHeight),X(2*Math.PI*P.y/p.clientHeight)),y.copy(b),e.update()}function Ue(r){C.set(r.clientX,r.clientY),$.subVectors(C,M),$.y>0?me(S()):$.y<0&&Me(S()),M.copy(C),e.update()}function Ze(r){j.set(r.clientX,r.clientY),A.subVectors(j,v).multiplyScalar(e.panSpeed),Q(A.x,A.y),v.copy(j),e.update()}function Se(r){Ae(r),r.deltaY<0?Me(S()):r.deltaY>0&&me(S()),e.update()}function Xe(r){let p=!1;switch(r.code){case e.keys.UP:Q(0,e.keyPanSpeed),p=!0;break;case e.keys.BOTTOM:Q(0,-e.keyPanSpeed),p=!0;break;case e.keys.LEFT:Q(e.keyPanSpeed,0),p=!0;break;case e.keys.RIGHT:Q(-e.keyPanSpeed,0),p=!0;break}p&&(r.preventDefault(),e.update())}function $e(){if(f.length==1)y.set(f[0].pageX,f[0].pageY);else{const r=.5*(f[0].pageX+f[1].pageX),p=.5*(f[0].pageY+f[1].pageY);y.set(r,p)}}function N(){if(f.length==1)v.set(f[0].pageX,f[0].pageY);else{const r=.5*(f[0].pageX+f[1].pageX),p=.5*(f[0].pageY+f[1].pageY);v.set(r,p)}}function k(){const r=f[0].pageX-f[1].pageX,p=f[0].pageY-f[1].pageY,O=Math.sqrt(r*r+p*p);M.set(0,O)}function Y(){e.enableZoom&&k(),e.enablePan&&N()}function ie(){e.enableZoom&&k(),e.enableRotate&&$e()}function ye(r){if(f.length==1)b.set(r.pageX,r.pageY);else{const O=Je(r),R=.5*(r.pageX+O.x),G=.5*(r.pageY+O.y);b.set(R,G)}P.subVectors(b,y).multiplyScalar(e.rotateSpeed);const p=e.domElement;p&&(W(2*Math.PI*P.x/p.clientHeight),X(2*Math.PI*P.y/p.clientHeight)),y.copy(b)}function be(r){if(f.length==1)j.set(r.pageX,r.pageY);else{const p=Je(r),O=.5*(r.pageX+p.x),R=.5*(r.pageY+p.y);j.set(O,R)}A.subVectors(j,v).multiplyScalar(e.panSpeed),Q(A.x,A.y),v.copy(j)}function we(r){const p=Je(r),O=r.pageX-p.x,R=r.pageY-p.y,G=Math.sqrt(O*O+R*R);C.set(0,G),$.set(0,Math.pow(C.y/M.y,e.zoomSpeed)),me($.y),M.copy(C)}function Ne(r){e.enableZoom&&we(r),e.enablePan&&be(r)}function Ie(r){e.enableZoom&&we(r),e.enableRotate&&ye(r)}function je(r){var p,O;e.enabled!==!1&&(f.length===0&&((p=e.domElement)==null||p.ownerDocument.addEventListener("pointermove",Ke),(O=e.domElement)==null||O.ownerDocument.addEventListener("pointerup",qe)),lo(r),r.pointerType==="touch"?ao(r):ro(r))}function Ke(r){e.enabled!==!1&&(r.pointerType==="touch"?co(r):io(r))}function qe(r){var p,O,R;mt(r),f.length===0&&((p=e.domElement)==null||p.releasePointerCapture(r.pointerId),(O=e.domElement)==null||O.ownerDocument.removeEventListener("pointermove",Ke),(R=e.domElement)==null||R.ownerDocument.removeEventListener("pointerup",qe)),e.dispatchEvent(u),c=i.NONE}function pt(r){mt(r)}function ro(r){let p;switch(r.button){case 0:p=e.mouseButtons.LEFT;break;case 1:p=e.mouseButtons.MIDDLE;break;case 2:p=e.mouseButtons.RIGHT;break;default:p=-1}switch(p){case de.DOLLY:if(e.enableZoom===!1)return;ge(r),c=i.DOLLY;break;case de.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(e.enablePan===!1)return;xe(r),c=i.PAN}else{if(e.enableRotate===!1)return;_e(r),c=i.ROTATE}break;case de.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(e.enableRotate===!1)return;_e(r),c=i.ROTATE}else{if(e.enablePan===!1)return;xe(r),c=i.PAN}break;default:c=i.NONE}c!==i.NONE&&e.dispatchEvent(l)}function io(r){if(e.enabled!==!1)switch(c){case i.ROTATE:if(e.enableRotate===!1)return;He(r);break;case i.DOLLY:if(e.enableZoom===!1)return;Ue(r);break;case i.PAN:if(e.enablePan===!1)return;Ze(r);break}}function ft(r){e.enabled===!1||e.enableZoom===!1||c!==i.NONE&&c!==i.ROTATE||(r.preventDefault(),e.dispatchEvent(l),Se(r),e.dispatchEvent(u))}function Qe(r){e.enabled===!1||e.enablePan===!1||Xe(r)}function ao(r){switch(gt(r),f.length){case 1:switch(e.touches.ONE){case ue.ROTATE:if(e.enableRotate===!1)return;$e(),c=i.TOUCH_ROTATE;break;case ue.PAN:if(e.enablePan===!1)return;N(),c=i.TOUCH_PAN;break;default:c=i.NONE}break;case 2:switch(e.touches.TWO){case ue.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Y(),c=i.TOUCH_DOLLY_PAN;break;case ue.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;ie(),c=i.TOUCH_DOLLY_ROTATE;break;default:c=i.NONE}break;default:c=i.NONE}c!==i.NONE&&e.dispatchEvent(l)}function co(r){switch(gt(r),c){case i.TOUCH_ROTATE:if(e.enableRotate===!1)return;ye(r),e.update();break;case i.TOUCH_PAN:if(e.enablePan===!1)return;be(r),e.update();break;case i.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ne(r),e.update();break;case i.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ie(r),e.update();break;default:c=i.NONE}}function ht(r){e.enabled!==!1&&r.preventDefault()}function lo(r){f.push(r)}function mt(r){delete _[r.pointerId];for(let p=0;p<f.length;p++)if(f[p].pointerId==r.pointerId){f.splice(p,1);return}}function gt(r){let p=_[r.pointerId];p===void 0&&(p=new K,_[r.pointerId]=p),p.set(r.pageX,r.pageY)}function Je(r){const p=r.pointerId===f[0].pointerId?f[1]:f[0];return _[p.pointerId]}s!==void 0&&this.connect(s),this.update()}};const Rn=new I,kt=g.forwardRef(function({start:n=[0,0,0],end:s=[0,0,0],mid:e,segments:a=20,...l},u){const i=g.useRef(null),[c]=g.useState(()=>new Ro(void 0,void 0,void 0)),E=g.useCallback((h,m,x,y=20)=>(h instanceof I?c.v0.copy(h):c.v0.set(...h),m instanceof I?c.v2.copy(m):c.v2.set(...m),x instanceof I?c.v1.copy(x):c.v1.copy(c.v0.clone().add(c.v2.clone().sub(c.v0)).add(Rn.set(0,c.v0.y-c.v2.y,0))),c.getPoints(y)),[]);g.useLayoutEffect(()=>{i.current.setPoints=(h,m,x)=>{const y=E(h,m,x);i.current.geometry&&i.current.geometry.setPositions(y.map(b=>b.toArray()).flat())}},[]);const d=g.useMemo(()=>E(n,s,e,a),[n,s,e,a]);return g.createElement(Mo,Z({ref:Ao([i,u]),points:d},l))}),Vn=g.forwardRef(({makeDefault:t,camera:n,regress:s,domElement:e,enableDamping:a=!0,onChange:l,onStart:u,onEnd:i,...c},E)=>{const d=J(C=>C.invalidate),h=J(C=>C.camera),m=J(C=>C.gl),x=J(C=>C.events),y=J(C=>C.setEvents),b=J(C=>C.set),P=J(C=>C.get),v=J(C=>C.performance),j=n||h,A=e||x.connected||m.domElement,M=g.useMemo(()=>new zn(j),[j]);return Ge(()=>{M.enabled&&M.update()},-1),g.useEffect(()=>(M.connect(A),()=>void M.dispose()),[A,s,M,d]),g.useEffect(()=>{const C=z=>{d(),s&&v.regress(),l&&l(z)},$=z=>{u&&u(z)},D=z=>{i&&i(z)};return M.addEventListener("change",C),M.addEventListener("start",$),M.addEventListener("end",D),()=>{M.removeEventListener("start",$),M.removeEventListener("end",D),M.removeEventListener("change",C)}},[l,u,i,M,d,y]),g.useEffect(()=>{if(t){const C=P().controls;return b({controls:M}),()=>b({controls:C})}},[t,M]),g.createElement("primitive",Z({ref:E,object:M,enableDamping:a},c))});function Ln(t){const n=t+"Geometry";return g.forwardRef(({args:s,children:e,...a},l)=>g.createElement("mesh",Z({ref:l},a),g.createElement(n,{attach:"geometry",args:s}),e))}const Dn=Ln("circle"),q=10,Bn=2,Fn=2,zt=10,Wn=10,Rt=(t,n,s)=>{const l=new I().subVectors(n,t).normalize().multiplyScalar(s);return new I().addVectors(t,l)},Yn=(t,n,s,e)=>{const a=new I().lerpVectors(t,n,.5),l=new I().subVectors(n,t).normalize(),u=new I(-l.y,l.x,l.z).normalize(),i=(s-e/2)*Wn;return new I().addVectors(a,u.multiplyScalar(i))},no=({links:t,nodes:n,onEdgeClick:s})=>{const e=g.useRef(null),{camera:a}=J(),l=new I,u=new I,i=new I,c=new I,E=new I,d=new I,h=new I,m=new I;Ge(()=>{e.current&&n&&e.current.children.forEach((y,b)=>{var F,f,_,B;const P=t[b];if(!P)return;const v=n.find(S=>S.ref_id===P.target),j=n.find(S=>S.ref_id===P.source);l.set((j==null?void 0:j.x)||0,(j==null?void 0:j.y)||0,(j==null?void 0:j.z)||0),u.set((v==null?void 0:v.x)||0,(v==null?void 0:v.y)||0,(v==null?void 0:v.z)||0);const A=y.children[0],M=y.children[1],C=y.children[2],$=y.children[3],D=t.filter(S=>S.source===P.source&&S.target===P.target||S.source===P.target&&S.target===P.source).length,z=t.filter((S,W)=>W<b&&(S.source===P.source&&S.target===P.target||S.source===P.target&&S.target===P.source)).length;if((j==null?void 0:j.ref_id)===(v==null?void 0:v.ref_id)){const[S,W,X]=Po(l);(F=A.setPoints)==null||F.call(A,l,X,S),(f=M.setPoints)==null||f.call(M,X,u,S),C.position.set(X.x,X.y,W.z),C.lookAt(S),C.rotateX(-Math.PI/2),$.position.set(X.x,X.y,W.z),$.lookAt(a.position)}else{m.copy(Rt(l,u,q)),h.copy(Rt(u,l,q+.5)),i.lerpVectors(m,h,.5),D>1?i.copy(Yn(m,h,z,D)):i.lerpVectors(m,h,.5);const S=30;c.subVectors(h,m).normalize().multiplyScalar(S/2),E.subVectors(i,c),d.addVectors(i,c);const W=new I().addVectors(m,E).multiplyScalar(.5),X=new I().addVectors(d,h).multiplyScalar(.5);(_=A.setPoints)==null||_.call(A,m,E,W),(B=M.setPoints)==null||B.call(M,d,h,X),C.position.set(h.x,h.y,h.z),C.lookAt(m),C.rotateX(-Math.PI/2),$.position.set(i.x,i.y,i.z),$.lookAt(a.position);let ee=Math.atan2(h.y-m.y,h.x-m.x);(ee>Math.PI/2||ee<-Math.PI/2)&&(ee+=Math.PI),$.rotation.set(0,0,ee);const re=m.distanceTo(h),Q=re<S?2:4;re<S?$.text=at(P.edge_type,zt):$.text=P.edge_type,$.fontSize=Q}})});const x=(y,b,P,v)=>{if(y==="CHILD_OF"||b==="string"||P==="string")return;const j=n==null?void 0:n.find($=>$.ref_id===b),A=n==null?void 0:n.find($=>$.ref_id===P),M=(j==null?void 0:j.type)||"",C=(A==null?void 0:A.type)||"";s(v,y,M,C)};return o.jsx("group",{ref:e,children:t.map(y=>o.jsxs("group",{children:[o.jsx(kt,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),o.jsx(kt,{color:"white",end:[0,0,0],lineWidth:1,start:[0,0,0]}),o.jsxs("mesh",{position:new I(0,0,0),children:[o.jsx("coneGeometry",{args:[Bn,Fn,32]}),o.jsx("meshBasicMaterial",{color:"white"})]}),o.jsx(eo,{anchorX:"center",anchorY:"middle",color:"white",...to,lineHeight:1,maxWidth:20,onClick:()=>x(y.edge_type,y.source,y.target,y.ref_id),rotation:[0,0,0],textAlign:"center",children:at(y.edge_type,zt)})]},y.ref_id))})};no.displayName="Lines";const Gn=["#ff13c9","#5af0ff","#3233ff","#c2f0c2","#ff6666","#99ccff","#ffb3b3"],Hn=L.div`
  color: white;
  background: rgba(0, 0, 0, 1);
  padding: 2px 5px;
  border-radius: 4px;
  word-wrap: break-word;
  text-align: center;
  white-space: nowrap;
  visibility: visible;
  font-size: 12px;
  font-style: normal;
  font-weight: 400;
`,Un=L(_o)`
  position: absolute;
`;new Vo(2,2,2);const so=g.memo(({node:t,setSelectedNode:n,onSimulationUpdate:s,isSelected:e})=>{var b;const a=g.useRef(null),[l,u]=g.useState(!1);console.log(e);const{size:i,camera:c}=J(),E=vo(P=>{if(t.type==="Thing")return;const{xy:[v,j],down:A,dragging:M,first:C,elapsedTime:$}=P;if(!(!M||C||$<100)&&A&&a.current){s();const D=(v-i.left)/window.innerWidth*i.width,z=(j-i.top)/window.innerHeight*i.height,_=new I(D/i.width*2-1,-z/i.height*2+1,0).unproject(c).multiply(new I(1,1,0)).clone();t.fx=_.x,t.fy=_.y}});Ge(()=>{a.current&&a.current.position.set(t.x||0,t.y||0,0)});const d=Gn[(b=t==null?void 0:t.children)==null?void 0:b.length]||"red",h=P=>{P.stopPropagation(),t.type!=="Thing"&&n()},m=at(t.type||"",q),x=()=>{u(!0)},y=()=>{u(!1)};return o.jsxs("mesh",{ref:a,onClick:h,...E(),onPointerOut:y,onPointerOver:x,position:new I(t.x,t.y,0),children:[o.jsx(Dn,{args:[q,30,20],children:o.jsx("meshStandardMaterial",{attach:"material",color:d})}),o.jsx(eo,{...to,clipRect:[-q,-q,q,q],color:"#000",fontSize:2,maxWidth:q*2,name:t.type,textAlign:"left",children:m}),l&&o.jsx(Un,{position:[0,5,0],zIndexRange:[100,0],children:o.jsx(Hn,{children:t.type})})]})});so.displayName="Node";const Zn=({simulation:t,setSelectedSchemaId:n,selectedId:s,setIsAddEdgeNode:e})=>{const[a]=Kt(u=>[u.schemas]),l=()=>{t&&(t.alpha(.05),t.restart())};return o.jsx(o.Fragment,{children:a.map((u,i)=>{const c=t.nodes()[i];return c?o.jsx(so,{isSelected:c.ref_id===s,node:c,onSimulationUpdate:l,setSelectedNode:()=>{e(!1),n(c.ref_id)}},c.ref_id):null})})},Xn=({schemasWithPositions:t,filteredLinks:n,setSelectedSchemaId:s,selectedSchemaId:e,setIsAddEdgeNode:a,onEdgeClick:l})=>{const[u,i]=g.useState(null),c=Pt(t),E=Pt(n);return g.useEffect(()=>{if(!t.length||!n.length)return;const d=structuredClone(t),h=structuredClone(n);if(u){c&&c.length!==t.length&&E&&E.length!==n.length&&(u.nodes(d).force("link",bt(h).id(x=>x.ref_id).distance(100)).force("charge",wt()).force("center",jt()).force("collide",vt(q+5)).alpha(.5).restart(),i({...u}));return}const m=go(d).force("link",bt(h).id(x=>x.ref_id).distance(120)).force("charge",wt().strength(-100)).force("center",jt()).force("collide",vt(q+5));i(m)},[t,u,n,c,E]),Ge(()=>{}),u?o.jsxs(o.Fragment,{children:[o.jsx(no,{links:n,nodes:u.nodes(),onEdgeClick:l}),o.jsx(Zn,{selectedId:e,setIsAddEdgeNode:a,setSelectedSchemaId:s,simulation:u})]}):null},nt=new Lo(0),Kn=({selectedSchemaId:t,links:n,schemasWithPositions:s,setSelectedSchemaId:e,setIsAddEdgeNode:a,onEdgeClick:l})=>o.jsxs(So,{camera:{zoom:1,position:[0,0,200]},id:"schema-canvas",linear:!0,orthographic:!0,children:[o.jsx("color",{args:[nt.r,nt.g,nt.b],attach:"background"}),xo&&o.jsx($o,{position:"right-bottom"}),o.jsx(qn,{}),o.jsx(No,{}),o.jsx(Xn,{filteredLinks:n,onEdgeClick:l,schemasWithPositions:s,selectedSchemaId:t,setIsAddEdgeNode:a,setSelectedSchemaId:e})]}),qn=()=>{g.useEffect(()=>{const s=a=>{["Meta","Alt"].includes(a.key)&&(document.body.style.cursor="grab")},e=a=>{["Meta","Alt"].includes(a.key)&&(document.body.style.cursor="default")};return window.addEventListener("keydown",s,!1),window.addEventListener("keyup",e,!1),()=>{window.removeEventListener("keydown",s,!1),window.removeEventListener("keyup",e,!1)}},[]);const t=()=>{document.body.style.cursor="grabbing"},n=()=>{document.body.style.cursor="default"};return o.jsx(Vn,{dampingFactor:1,enableDamping:!0,enablePan:!0,enableRotate:!1,enableZoom:!0,maxZoom:20,minZoom:1,onEnd:n,onStart:t,zoomSpeed:1.5,zoomToCursor:!0})},Qn=t=>o.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 18 19",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M9.5002 0.270145C10.3742 0.270145 11.1128 0.571885 11.7161 1.17537C12.3193 1.77868 12.6209 2.51732 12.6209 3.39129C12.6209 4.17273 12.3716 4.85117 11.873 5.42662C11.3744 6.00189 10.7483 6.34792 9.99474 6.46469L9.99474 9.0052L13.8388 9.0052C14.2785 9.0052 14.6549 9.16172 14.9679 9.47476C15.2809 9.78779 15.4375 10.1642 15.4375 10.6039L15.4375 12.564L17.0171 12.564C17.2435 12.564 17.4334 12.6405 17.5866 12.7936C17.7396 12.9468 17.8162 13.1366 17.8162 13.3631L17.8162 17.5042C17.8162 17.7389 17.7396 17.9321 17.5866 18.0836C17.4334 18.2352 17.2435 18.311 17.0171 18.311L12.8759 18.311C12.6412 18.311 12.4481 18.2345 12.2965 18.0814C12.1449 17.9282 12.0692 17.7384 12.0692 17.5119L12.0692 13.3707C12.0692 13.136 12.1457 12.9429 12.2987 12.7913C12.452 12.6398 12.6418 12.564 12.8682 12.564L14.4479 12.564L14.4479 10.6039C14.4479 10.4262 14.3908 10.2803 14.2767 10.166C14.1624 10.0518 14.0164 9.99478 13.8388 9.99478L5.16112 9.99478C4.98349 9.99478 4.83753 10.0518 4.72323 10.166C4.6091 10.2803 4.55203 10.4262 4.55203 10.6039L4.55203 12.6115C5.3056 12.7283 5.93168 13.0743 6.43026 13.6496C6.92885 14.225 7.17814 14.9034 7.17814 15.6849C7.17814 16.5587 6.87648 17.2973 6.27317 17.9008C5.66969 18.5041 4.93096 18.8058 4.05699 18.8058C3.18303 18.8058 2.44439 18.5041 1.84107 17.9008C1.23792 17.2973 0.936342 16.5587 0.936343 15.6849C0.936343 14.9034 1.18564 14.225 1.68422 13.6496C2.18281 13.0743 2.80888 12.7283 3.56245 12.6115L3.56245 10.6039C3.56245 10.1642 3.71897 9.78779 4.03201 9.47476C4.34504 9.16172 4.72142 9.0052 5.16112 9.0052L9.00516 9.0052L9.00516 6.46469C8.25159 6.34792 7.62552 6.00189 7.12693 5.42662C6.62835 4.85117 6.37905 4.17273 6.37905 3.39129C6.37905 2.51732 6.68071 1.77868 7.28403 1.17537C7.88751 0.571885 8.62623 0.270145 9.5002 0.270145Z",fill:"currentColor"})}),Jn=({onClose:t,activeTab:n,setActiveTab:s})=>o.jsxs(es,{children:[o.jsxs(ts,{children:[o.jsx(Qn,{}),o.jsx(os,{children:"Blueprint"})]}),o.jsxs(ns,{children:[o.jsx(Vt,{active:n==="all",onClick:()=>s("all"),children:"Show All"}),o.jsx(Vt,{active:n==="parent",onClick:()=>s("parent"),children:"Parent Only"})]}),o.jsx(ss,{onClick:t,children:o.jsx(ut,{})})]}),es=L(w)`
  background-color: ${V.BG1};
  height: 64px;
  width: 100%;
  border-top-left-radius: 9px;
  border-top-right-radius: 9px;
  justify-content: space-between;
  padding: 17px;
`,ts=L.div`
  display: flex;
  align-items: center;
  font-size: 22px;
  font-weight: 400;
  font-family: Barlow;

  svg {
    color: ${V.GRAY6};
    margin-left: 6px;
  }
`,os=L.span`
  color: ${V.white};
  font-weight: 400;
  font-family: Barlow;
  margin-left: 15px;
  font-size: 22px;
`,ns=L.div`
  display: flex;
  position: absolute;
  top: 16px;
  right: 60px;
  background-color: ${V.divider2};
  border-radius: 6px;
  padding: 2px;
`,Vt=L.div`
  color: ${t=>t.active?V.white:V.GRAY6};
  background-color: ${t=>t.active?V.BUTTON1:"transparent"};
  padding: 6px 12px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  margin-left: 2px;
  font-family: Barlow;

  &:first-child {
    margin-left: 0;
  }
`,ss=L.div`
  position: absolute;
  top: 16px;
  right: 12px;
  font-size: 20px;
  color: ${V.GRAY6};
  cursor: pointer;
  z-index: 1;

  svg {
    width: 30px;
    height: 32px;
  }
`,rs=t=>o.jsxs("svg",{width:"1em",height:"1em",viewBox:"0 0 23 22",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[o.jsx("mask",{id:"mask0_8954_27793",maskUnits:"userSpaceOnUse",x:"10",y:"-3",width:"16",height:"16",children:o.jsx("rect",{x:"10",y:"-3",width:"1em",height:"1em",fill:"currentColor"})}),o.jsx("g",{mask:"url(#mask0_8954_27793)",children:o.jsx("path",{d:"M17.5 5.50005H14.1666C14.025 5.50005 13.9062 5.45212 13.8104 5.35625C13.7145 5.26037 13.6666 5.14157 13.6666 4.99985C13.6666 4.85812 13.7145 4.73939 13.8104 4.64367C13.9062 4.54794 14.025 4.50008 14.1666 4.50008H17.5V1.16675C17.5 1.02508 17.5479 0.906331 17.6438 0.810498C17.7396 0.714665 17.8584 0.666748 18.0002 0.666748C18.1419 0.666748 18.2606 0.714665 18.3563 0.810498C18.4521 0.906331 18.4999 1.02508 18.4999 1.16675V4.50008H21.8333C21.9749 4.50008 22.0937 4.54802 22.1895 4.64388C22.2853 4.73976 22.3333 4.85856 22.3333 5.00028C22.3333 5.14202 22.2853 5.26074 22.1895 5.35647C22.0937 5.45219 21.9749 5.50005 21.8333 5.50005H18.4999V8.83338C18.4999 8.97505 18.452 9.0938 18.3561 9.18963C18.2602 9.28547 18.1414 9.33338 17.9997 9.33338C17.858 9.33338 17.7393 9.28547 17.6435 9.18963C17.5478 9.0938 17.5 8.97505 17.5 8.83338V5.50005Z",fill:"currentColor"})}),o.jsx("path",{d:"M1.33333 6C1.33333 7.47276 2.52724 8.66667 4 8.66667C5.47276 8.66667 6.66667 7.47276 6.66667 6C6.66667 4.52724 5.47276 3.33333 4 3.33333C2.52724 3.33333 1.33333 4.52724 1.33333 6ZM14.3333 19C14.3333 20.4728 15.5272 21.6667 17 21.6667C18.4728 21.6667 19.6667 20.4728 19.6667 19C19.6667 17.5272 18.4728 16.3333 17 16.3333C15.5272 16.3333 14.3333 17.5272 14.3333 19ZM3.64645 6.35355L16.6464 19.3536L17.3536 18.6464L4.35355 5.64645L3.64645 6.35355Z",fill:"currentColor"})]}),is=({onCreateNew:t,onAddEdgeNode:n})=>o.jsxs(as,{children:[o.jsx(st,{"data-testid":"add-schema-type",onClick:t,children:o.jsx(rt,{children:o.jsx(Jt,{})})}),o.jsx(st,{"data-testid":"add-edge",onClick:n,children:o.jsx(rt,{children:o.jsx(rs,{})})}),o.jsx(st,{disabled:!0,children:o.jsx(rt,{children:o.jsx(Qt,{})})})]}),as=L(w).attrs({align:"flex-start",direction:"column",justify:"flex-start"})`
  flex: 1;
  gap: 17px;
  padding: 16px 0 0 16px;
`,st=L(w).attrs({align:"center",justify:"center",p:0})`
  position: relative;
  width: 40px;
  height: 40px;
  flex-direction: row;
  color: ${V.GRAY6};
  background: ${({disabled:t})=>t?V.disableBtn:V.BG1};
  cursor: pointer;
  border-radius: 6px;
  transition: ${({theme:t})=>t.transitions.create(["opacity","box-shadow","background-color"])};

  &:hover {
    color: ${({disabled:t})=>t?V.GRAY6:V.white};
  }

  &:active {
    color: ${V.white};
    background: ${({disabled:t})=>t?V.BG1:V.black};
  }

  &.root {
    border-radius: 50%;
    padding: 0;
    align-items: center;
    justify-content: center;
    border: none;
  }
`,rt=L(w)`
  justify-content: center;
  align-items: center;
  font-size: 24px;
`,cs=({Close:t})=>{const[n,s]=g.useState(""),[e,a]=g.useState(!1),[l,u]=g.useState(!1),[i,c]=g.useState(!1),[E,d]=g.useState({refId:"",edgeType:"",source:"",target:""}),[h,m]=g.useState(!1),[x,y]=g.useState("all"),[b,P,v,j]=Kt(f=>[f.schemas,f.links,f.setSchemas,f.setSchemaLinks]);g.useEffect(()=>{(async()=>{u(!0);try{const _=await Ct(),B=_.schemas.filter(S=>S.ref_id&&!S.is_deleted);v(B.length>0?B:_.schemas),j(_.edges.length>0?_.edges:[]),u(!1)}catch(_){console.error("Error fetching data:",_),u(!1)}})()},[v,j]);const A=f=>{if(b.some(B=>B.ref_id===f.ref_id))v(b.map(B=>B.ref_id===f.ref_id?{...f,children:[]}:B));else{v([...b,{...f,children:[]}]);const B=b.find(S=>f.parent===S.type);j([...P,{ref_id:`new-link-${P.length}`,edge_type:"CHILD_OF",source:f.ref_id||"new",target:(B==null?void 0:B.ref_id)||"new"}])}},M=async()=>{const f=await Ct();v(f.schemas.filter(_=>_.ref_id&&!_.is_deleted&&_.ref_id)),j(f.edges)},C=f=>{v(b.filter(_=>_.type!==f))},$=b.map(f=>({...f,children:b.filter(_=>_.parent===f.type).map(_=>_.ref_id||"")})),D=P.filter(f=>$.some(_=>_.ref_id===f.source)&&$.some(_=>_.ref_id===f.target)),z=b.find(f=>f.ref_id===n)||null;if(l)return o.jsx(w,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:o.jsx(le,{color:V.white})});const F=x==="all"?D:D.filter(f=>f.edge_type==="CHILD_OF");return o.jsxs(o.Fragment,{children:[o.jsx(w,{ml:-20,mr:-20,mt:-20,children:o.jsx(Jn,{activeTab:x,onClose:t,setActiveTab:y})}),o.jsxs(w,{align:"stretch",direction:"row",grow:1,children:[o.jsx(w,{mb:-20,ml:-20,children:z||e?o.jsx(Lt,{children:o.jsx(Dt,{children:o.jsx(An,{graphLoading:h,onDelete:C,onSchemaCreate:A,onSchemaUpdate:M,selectedSchema:z,setGraphLoading:m,setIsCreateNew:a,setSelectedSchemaId:s})})}):null}),o.jsx(w,{children:i?o.jsx(Lt,{children:o.jsx(Dt,{children:o.jsx(bn,{edgeData:E,setGraphLoading:m,setIsAddEdgeNode:c})})}):null}),o.jsx(w,{children:o.jsx(is,{onAddEdgeNode:()=>{c(!0),a(!1),s(""),d({refId:"",edgeType:"",source:"",target:""})},onCreateNew:()=>{c(!1),a(!0),s("")}})}),o.jsx(ls,{direction:"row",grow:1,children:o.jsx(ds,{children:h?o.jsx(w,{align:"center",basis:"100%",grow:1,justify:"center",shrink:1,children:o.jsx(le,{color:V.white})}):o.jsx(Kn,{links:F,onEdgeClick:(f,_,B,S)=>{d({refId:f,edgeType:_,source:B,target:S}),c(!0),a(!1),s("")},schemasWithPositions:$,selectedSchemaId:n,setIsAddEdgeNode:c,setSelectedSchemaId:s})})})]})]})},ls=L(w)`
  flex: 1 1 auto;
  justify-content: center;
  position: relative;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Lt=L(w)`
  width: 100%;
  max-width: 400px;
  background: ${V.BG1};
  border-bottom-right-radius: 16px;
  flex-grow: 1;
  flex-shrink: 1;
  min-width: 300px;
  overflow: hidden;
  max-height: calc(100vh - 20px);

  @media (max-width: 1440px) {
    max-height: calc(95vh - 20px);
  }

  @media (max-width: 1024px) {
    max-height: calc(70vh - 20px);
  }

  @media (max-width: 924px) {
    max-height: calc(70vh - 20px);
  }
`,Dt=L.div`
  height: 100%;
  overflow-y: auto;
  padding: 16px;
`,ds=L(w)`
  flex: 1 1 100%;
`,us=()=>{const{close:t}=Zt("blueprintGraph"),n=()=>{t()};return o.jsx(yo,{background:"black",id:"blueprintGraph",kind:"full",preventOutsideClose:!0,children:o.jsx(cs,{Close:n})})},Ns=g.memo(us);export{Ns as BlueprintModal};
